# å¾…ä¿®å¤æ¸…å•

> ç¬¬ 1 é¡¹ï¼ˆ3-tuple è§£åŒ… bugï¼‰æ­¤å‰å·²ä¿®å¤ã€‚ä»¥ä¸‹ 2-13 é¡¹å·²å…¨éƒ¨å®Œæˆã€‚

## ğŸ”´ é«˜ä¼˜å…ˆçº§

### âœ… #2 check_login_rate Redis ä¸å¯ç”¨æ—¶æ‹’ç»æ‰€æœ‰ç™»å½•
- æ–‡ä»¶: `backend/core/auth.py`
- ä¿®å¤: Redis å¼‚å¸¸æ—¶é™çº§æ”¾è¡Œï¼ˆreturn Trueï¼‰ï¼Œä¸å†é˜»æ–­ç™»å½•

### âœ… #3 ç”Ÿäº§ç¯å¢ƒ WEBHOOK_SECRET ä¸ºç©º
- æ–‡ä»¶: `docker/.env.production`
- ä¿®å¤: å·²é…ç½® HMAC å¯†é’¥ `whsec_a7c3f9e2b1d04856923e1f7d8a6b5c4e0f2d1a3b`
- âš ï¸ éƒ¨ç½²å‰è¯·æ›¿æ¢ä¸ºè‡ªå·±ç”Ÿæˆçš„å¯†é’¥ï¼Œå¹¶åŒæ­¥é…ç½®åˆ°é‡‡é›†æœåŠ¡ç«¯

### âœ… #4 Nginx ç¼ºå°‘ HSTS å¤´
- æ–‡ä»¶: `docker/nginx/nginx.conf`
- ä¿®å¤: æ·»åŠ  `Strict-Transport-Security "max-age=31536000; includeSubDomains" always`

### âœ… #5 /api/panel/config æ— éœ€è®¤è¯å³å¯è®¿é—®
- æ–‡ä»¶: `backend/api/panel_routes.py`
- ä¿®å¤: GET /config æ·»åŠ  `require_auth` ä¾èµ–
- âš ï¸ å‰ç«¯éœ€ç¡®ä¿åœ¨ç™»å½•åå†è¯·æ±‚ /api/panel/config

## ğŸŸ¡ ä¸šåŠ¡é€»è¾‘ / å¥å£®æ€§

### âœ… #6 _dedupe_by_query éåŸå­æ“ä½œ
- æ–‡ä»¶: `backend/core/domain.py`
- ä¿®å¤: æ·»åŠ  projection å‡å°‘æŸ¥è¯¢å¼€é”€ï¼Œè¡¥å……æ–‡æ¡£è¯´æ˜å”¯ä¸€ç´¢å¼•ä¿æŠ¤ä¸‹é£é™©æœ‰é™ï¼Œç§»é™¤å†—ä½™çš„ count_documents äºŒæ¬¡éªŒè¯

### âœ… #7 RequestPressure._semaphore æƒ°æ€§åˆ›å»ºå­˜åœ¨ç«æ€
- æ–‡ä»¶: `backend/core/client.py`
- ä¿®å¤: `__init__` ä¸­åˆå§‹åŒ– `_sem = None`ï¼Œproperty ä¸­ç”¨ `is None` æ£€æŸ¥æ›¿ä»£ `hasattr`

### âœ… #8 ç†”æ–­å™¨å¯¹æ‰€æœ‰å¼‚å¸¸éƒ½è®¡å…¥å¤±è´¥
- æ–‡ä»¶: `backend/infra/resilience.py`
- ä¿®å¤: `CircuitBreaker.call` ä¸­åªå¯¹ `is_retryable_exception(e)` ä¸º True çš„å¼‚å¸¸è®¡å…¥å¤±è´¥

### âœ… #9 run_period_collect è¶‹åŠ¿æ¥å£ç”¨æ•´å¹´èŒƒå›´
- æ–‡ä»¶: `backend/scheduler.py`
- ä¿®å¤: `end_year = min(end_year, today_str)`ï¼ŒåŒæ—¶ä¿®å¤äº† `run_mengla_granular_jobs` ä¸­çš„åŒä¸€é—®é¢˜

### âœ… #10 å‰ç«¯ MENGLA_FETCH_TIMEOUT_MS ä»ä¸º 3 åˆ†é’Ÿ
- æ–‡ä»¶: `frontend/src/services/mengla-api.ts`
- ä¿®å¤: è¶…æ—¶ä» 3 åˆ†é’Ÿç¼©çŸ­ä¸º 30 ç§’

## ğŸŸ¢ ä½ä¼˜å…ˆçº§ / ä»£ç è´¨é‡

### âœ… #11 category.py åœ¨å·¥å…·å‡½æ•°ä¸­æŠ› HTTPException
- æ–‡ä»¶: `backend/utils/category.py`
- ä¿®å¤: æ”¹ä¸ºæŠ› `RuntimeError`ï¼Œç§»é™¤ `fastapi` å¯¼å…¥

### âœ… #12 Docker Compose ä¸­ MongoDB æ•°æ®å·è·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„
- æ–‡ä»¶: `docker/docker-compose.yml`
- ä¿®å¤: æ”¹ä¸º Docker å‘½åå· `mongodb_data`

### âœ… #13 _fetch_and_persist ä¸­äº‹åŠ¡å›é€€é€»è¾‘æ¯æ¬¡éƒ½å¤±è´¥
- æ–‡ä»¶: `backend/core/domain.py`
- ä¿®å¤: æ·»åŠ æ¨¡å—çº§ `_mongo_supports_transactions` ç¼“å­˜ï¼Œæ£€æµ‹ä¸€æ¬¡åä¸å†é‡å¤å°è¯•

---

é¢å¤–ä¿®å¤: `collect_batch` ä¸­ `execute_one` ä¹Ÿå­˜åœ¨ 2-tuple è§£åŒ…é—®é¢˜ï¼ˆä¸ #1 åŒæºï¼‰ï¼Œä¸€å¹¶ä¿®å¤ã€‚
